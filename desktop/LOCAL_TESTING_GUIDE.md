# æ¡Œé¢åº”ç”¨æœ¬åœ°æµ‹è¯•æŒ‡å—

## ä¸ºä»€ä¹ˆéœ€è¦æœ¬åœ°æµ‹è¯•ï¼Ÿ

åœ¨æ¨é€åˆ°GitHubä¹‹å‰æœ¬åœ°æµ‹è¯•å¯ä»¥ï¼š
- âš¡ **èŠ‚çœæ—¶é—´**ï¼šæœ¬åœ°æ„å»º5-10åˆ†é’Ÿï¼ŒGitHub Actionséœ€è¦10-15åˆ†é’Ÿ
- ğŸ› **å¿«é€Ÿè°ƒè¯•**ï¼šç«‹å³çœ‹åˆ°é”™è¯¯ï¼Œæ— éœ€ç­‰å¾…è¿œç¨‹æ„å»º
- ğŸ’° **èŠ‚çœèµ„æº**ï¼šå‡å°‘GitHub Actionsçš„ä½¿ç”¨æ¬¡æ•°
- âœ… **æå‰éªŒè¯**ï¼šç¡®ä¿ä»£ç æ²¡é—®é¢˜å†æ¨é€

## å‰ç½®è¦æ±‚

### å¿…éœ€è½¯ä»¶

1. **Node.js 22.x**
   - ä¸‹è½½: https://nodejs.org/
   - éªŒè¯: `node --version`
   - åº”è¯¥æ˜¾ç¤º: `v22.x.x`

2. **pnpm**
   - å®‰è£…: `npm install -g pnpm`
   - éªŒè¯: `pnpm --version`
   - åº”è¯¥æ˜¾ç¤º: `10.x.x`

3. **Git**ï¼ˆå¦‚æœè¦æ¨é€ä»£ç ï¼‰
   - ä¸‹è½½: https://git-scm.com/
   - éªŒè¯: `git --version`

### å¯é€‰è½¯ä»¶

- **7-Zip** æˆ– **WinRAR**ï¼šç”¨äºæŸ¥çœ‹æ‰“åŒ…åçš„æ–‡ä»¶
- **Visual Studio Code**ï¼šç”¨äºç¼–è¾‘ä»£ç 

## æµ‹è¯•æ–¹å¼

æˆ‘ä»¬æä¾›äº†ä¸‰ç§æµ‹è¯•æ–¹å¼ï¼Œæ ¹æ®æ‚¨çš„éœ€æ±‚é€‰æ‹©ï¼š

### æ–¹å¼1ï¼šå®Œæ•´æ„å»ºæµ‹è¯•ï¼ˆæ¨èï¼‰

**é€‚ç”¨åœºæ™¯**ï¼š
- å‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬
- éªŒè¯ä¾èµ–æ‰“åŒ…æ˜¯å¦æ­£ç¡®
- æµ‹è¯•å®‰è£…åŒ…

**æ­¥éª¤**ï¼š

1. æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆCMDï¼‰æˆ–PowerShell
2. è¿›å…¥desktopç›®å½•ï¼š
   ```cmd
   cd path\to\video-slicer-web\desktop
   ```
3. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
   ```cmd
   test-build-windows.bat
   ```
4. ç­‰å¾…æ„å»ºå®Œæˆï¼ˆçº¦5-10åˆ†é’Ÿï¼‰
5. åœ¨ `release` ç›®å½•ä¸­æ‰¾åˆ° `.exe` å®‰è£…åŒ…
6. åŒå‡»å®‰è£…å¹¶æµ‹è¯•

**è„šæœ¬åšäº†ä»€ä¹ˆ**ï¼š
- âœ… æ£€æŸ¥Node.jså’Œpnpm
- âœ… æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
- âœ… å®‰è£…æ‰€æœ‰ä¾èµ–
- âœ… æ„å»ºwebé¡¹ç›®
- âœ… ä¸‹è½½FFmpeg
- âœ… æ„å»ºå¹¶æ‰“åŒ…desktopåº”ç”¨
- âœ… ç”Ÿæˆå®‰è£…åŒ…

### æ–¹å¼2ï¼šå¿«é€Ÿå¼€å‘æµ‹è¯•

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¿®æ”¹ä»£ç åå¿«é€ŸéªŒè¯
- è°ƒè¯•åŠŸèƒ½
- ä¸éœ€è¦å®‰è£…åŒ…

**æ­¥éª¤**ï¼š

1. è¿›å…¥desktopç›®å½•
2. è¿è¡Œå¼€å‘è„šæœ¬ï¼š
   ```cmd
   dev-test.bat
   ```
3. åº”ç”¨ä¼šç›´æ¥å¯åŠ¨ï¼Œæ— éœ€å®‰è£…

**ä¼˜åŠ¿**ï¼š
- âš¡ é€Ÿåº¦å¿«ï¼ˆ1-2åˆ†é’Ÿï¼‰
- ğŸ” å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ§åˆ¶å°è¾“å‡º
- ğŸ› æ–¹ä¾¿è°ƒè¯•

**é™åˆ¶**ï¼š
- âŒ ä¸ç”Ÿæˆå®‰è£…åŒ…
- âŒ ä¸æµ‹è¯•æ‰“åŒ…è¿‡ç¨‹
- âŒ ä¾èµ–å¿…é¡»å·²ç»å®‰è£…

### æ–¹å¼3ï¼šä¾èµ–æ£€æŸ¥

**é€‚ç”¨åœºæ™¯**ï¼š
- éªŒè¯ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
- æ’æŸ¥"Cannot find module"é”™è¯¯
- æ£€æŸ¥å¼€å‘ç¯å¢ƒ

**æ­¥éª¤**ï¼š

1. è¿›å…¥desktopç›®å½•
2. è¿è¡Œæ£€æŸ¥è„šæœ¬ï¼š
   ```cmd
   check-dependencies.bat
   ```
3. æŸ¥çœ‹æ£€æŸ¥ç»“æœ

**æ£€æŸ¥çš„ä¾èµ–**ï¼š
- electron-updater
- fs-extra
- uuid
- builder-util-runtime
- debug
- ms
- js-yaml
- semver

## è¯¦ç»†æ­¥éª¤è¯´æ˜

### å®Œæ•´æ„å»ºæµç¨‹

#### 1. å‡†å¤‡ç¯å¢ƒ

```cmd
# å…‹éš†æˆ–æ›´æ–°ä»£ç 
git clone https://github.com/superyueming/video-slicer.git
cd video-slicer\desktop

# æˆ–è€…å¦‚æœå·²ç»å…‹éš†äº†
cd path\to\video-slicer-web\desktop
git pull
```

#### 2. è¿è¡Œæ„å»º

```cmd
test-build-windows.bat
```

#### 3. æŸ¥çœ‹æ„å»ºè¾“å‡º

æ„å»ºè¿‡ç¨‹ä¼šæ˜¾ç¤º8ä¸ªæ­¥éª¤ï¼š
```
[1/8] æ£€æŸ¥Node.js...
[2/8] æ£€æŸ¥pnpm...
[3/8] æ¸…ç†æ—§çš„æ„å»º...
[4/8] å®‰è£…desktopä¾èµ–...
[5/8] æ„å»ºwebé¡¹ç›®...
[6/8] ä¸‹è½½FFmpeg...
[7/8] æ„å»ºdesktopåº”ç”¨...
[8/8] æ„å»ºç»“æœ
```

#### 4. æµ‹è¯•å®‰è£…åŒ…

æ„å»ºæˆåŠŸåï¼š
```
release\
  â”œâ”€â”€ AIè§†é¢‘æ™ºèƒ½åˆ‡ç‰‡ Setup 1.0.0.exe  â† å®‰è£…åŒ…
  â””â”€â”€ win-unpacked\                    â† è§£å‹åçš„æ–‡ä»¶
      â”œâ”€â”€ resources\
      â”‚   â””â”€â”€ app\                     â† åº”ç”¨ä»£ç 
      â”‚       â”œâ”€â”€ dist\
      â”‚       â”œâ”€â”€ node_modules\        â† æ£€æŸ¥è¿™ä¸ªç›®å½•ï¼
      â”‚       â””â”€â”€ ...
      â””â”€â”€ AIè§†é¢‘æ™ºèƒ½åˆ‡ç‰‡.exe
```

#### 5. éªŒè¯ä¾èµ–

**æ–¹æ³•Aï¼šæŸ¥çœ‹æ–‡ä»¶**

è¿›å…¥è§£å‹ç›®å½•ï¼š
```cmd
cd release\win-unpacked\resources\app
dir node_modules
```

åº”è¯¥èƒ½çœ‹åˆ°å¤§é‡çš„ä¾èµ–ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š
- `ms`
- `debug`
- `electron-updater`
- `fs-extra`
- ç­‰ç­‰

**æ–¹æ³•Bï¼šæµ‹è¯•require**

```cmd
cd release\win-unpacked\resources\app
node -e "require('ms')"
node -e "require('debug')"
node -e "require('electron-updater')"
```

å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜ä¾èµ–æ­£ç¡®ã€‚

#### 6. å®‰è£…å¹¶æµ‹è¯•

åŒå‡» `AIè§†é¢‘æ™ºèƒ½åˆ‡ç‰‡ Setup 1.0.0.exe` å®‰è£…ã€‚

å®‰è£…åçš„ç›®å½•ï¼š
```
C:\Users\<ä½ çš„ç”¨æˆ·å>\AppData\Local\Programs\video-slicer-desktop\
```

æµ‹è¯•æ¸…å•ï¼š
- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] æ²¡æœ‰"Cannot find module"é”™è¯¯
- [ ] å¯ä»¥é€‰æ‹©è§†é¢‘æ–‡ä»¶
- [ ] å¯ä»¥æŸ¥çœ‹è§†é¢‘ä¿¡æ¯
- [ ] å¯ä»¥æå–éŸ³é¢‘
- [ ] å¯ä»¥ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] å¯ä»¥æ¥æ”¶AIåˆ†æç»“æœ
- [ ] å¯ä»¥å‰ªè¾‘è§†é¢‘
- [ ] å¯ä»¥ä¸‹è½½ç”Ÿæˆçš„è§†é¢‘

## å¸¸è§é—®é¢˜

### Q1: æ„å»ºå¤±è´¥ï¼Œæç¤º"pnpm: command not found"

**è§£å†³æ–¹æ¡ˆ**ï¼š
```cmd
npm install -g pnpm
```

### Q2: æ„å»ºå¤±è´¥ï¼Œæç¤º"node: command not found"

**è§£å†³æ–¹æ¡ˆ**ï¼š
å®‰è£…Node.js 22.x: https://nodejs.org/

### Q3: FFmpegä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ‰‹åŠ¨ä¸‹è½½å¹¶æ”¾ç½®ï¼š
1. ä¸‹è½½: https://github.com/BtbN/FFmpeg-Builds/releases/latest
2. è§£å‹ `ffmpeg.exe`
3. æ”¾åˆ° `desktop\resources\ffmpeg\win32\ffmpeg.exe`

### Q4: æ„å»ºæˆåŠŸä½†åº”ç”¨å¯åŠ¨å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š
1. è¿è¡Œ `check-dependencies.bat` æ£€æŸ¥ä¾èµ–
2. æŸ¥çœ‹ `release\win-unpacked\resources\app\node_modules`
3. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

### Q5: å®‰è£…åŒ…å¤ªå¤§

**åŸå› **ï¼š
ç¦ç”¨ASARåï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æ˜æ–‡ï¼Œä½“ç§¯ä¼šå¢åŠ ã€‚

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
- ç­‰ä¾èµ–é—®é¢˜è§£å†³åï¼Œå¯ä»¥é‡æ–°å¯ç”¨ASAR
- ä½¿ç”¨ `asarUnpack` é€‰æ‹©æ€§æ‰“åŒ…

### Q6: ä¿®æ”¹ä»£ç åéœ€è¦é‡æ–°æ„å»ºå—ï¼Ÿ

**å–å†³äºä¿®æ”¹å†…å®¹**ï¼š
- ä¿®æ”¹ `src/*.ts`ï¼šéœ€è¦é‡æ–°æ„å»º
- ä¿®æ”¹ `package.json`ï¼šéœ€è¦é‡æ–°å®‰è£…ä¾èµ–å¹¶æ„å»º
- ä¿®æ”¹webé¡¹ç›®ï¼šéœ€è¦é‡æ–°æ„å»ºwebé¡¹ç›®

**å¿«é€Ÿæµ‹è¯•**ï¼š
ä½¿ç”¨ `dev-test.bat` å¯ä»¥å¿«é€Ÿæµ‹è¯•ä»£ç ä¿®æ”¹ã€‚

## æ„å»ºæ—¶é—´å‚è€ƒ

| æ­¥éª¤ | é¦–æ¬¡ | åç»­ |
|------|------|------|
| å®‰è£…ä¾èµ– | 3-5åˆ†é’Ÿ | 30ç§’ï¼ˆå¦‚æœæ²¡æœ‰æ–°ä¾èµ–ï¼‰ |
| æ„å»ºwebé¡¹ç›® | 1-2åˆ†é’Ÿ | 1-2åˆ†é’Ÿ |
| ä¸‹è½½FFmpeg | 1-2åˆ†é’Ÿ | è·³è¿‡ï¼ˆå¦‚æœå·²å­˜åœ¨ï¼‰ |
| æ„å»ºdesktop | 2-3åˆ†é’Ÿ | 2-3åˆ†é’Ÿ |
| **æ€»è®¡** | **7-12åˆ†é’Ÿ** | **4-6åˆ†é’Ÿ** |

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨å¼€å‘æ¨¡å¼è¿›è¡Œå¿«é€Ÿè¿­ä»£

```cmd
# ä¿®æ”¹ä»£ç 
# è¿è¡Œå¼€å‘æ¨¡å¼æµ‹è¯•
dev-test.bat
# å¦‚æœæœ‰é—®é¢˜ï¼Œç»§ç»­ä¿®æ”¹
# é‡å¤ä¸Šè¿°æ­¥éª¤
```

### 2. å®Œæ•´æ„å»ºå‰å…ˆæ£€æŸ¥ä¾èµ–

```cmd
check-dependencies.bat
```

ç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½æ­£ç¡®åå†æ„å»ºã€‚

### 3. å®šæœŸæ¸…ç†

```cmd
# æ¸…ç†node_modules
rmdir /s /q node_modules

# æ¸…ç†æ„å»ºäº§ç‰©
rmdir /s /q dist
rmdir /s /q release

# é‡æ–°å®‰è£…
pnpm install
```

### 4. ä¿å­˜æ„å»ºäº§ç‰©

æˆåŠŸæ„å»ºåï¼Œä¿å­˜å®‰è£…åŒ…ï¼š
```cmd
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir backups

# å¤åˆ¶å®‰è£…åŒ…
copy "release\AIè§†é¢‘æ™ºèƒ½åˆ‡ç‰‡ Setup 1.0.0.exe" "backups\v1.0.0-%date%.exe"
```

### 5. å¯¹æ¯”ä¸åŒç‰ˆæœ¬

ä½¿ç”¨7-ZipæŸ¥çœ‹ä¸åŒç‰ˆæœ¬çš„å†…å®¹ï¼š
```cmd
# è§£å‹app.asarï¼ˆå¦‚æœä½¿ç”¨ASARï¼‰
asar extract "release\win-unpacked\resources\app.asar" extracted

# æˆ–è€…ç›´æ¥æŸ¥çœ‹ï¼ˆå¦‚æœç¦ç”¨ASARï¼‰
explorer "release\win-unpacked\resources\app"
```

## æ¨é€åˆ°GitHubå‰çš„æ£€æŸ¥æ¸…å•

- [ ] æœ¬åœ°æ„å»ºæˆåŠŸ
- [ ] ä¾èµ–æ£€æŸ¥é€šè¿‡
- [ ] å®‰è£…åŒ…å¯ä»¥æ­£å¸¸å®‰è£…
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ²¡æœ‰"Cannot find module"é”™è¯¯
- [ ] ä»£ç å·²æäº¤åˆ°æœ¬åœ°ä»“åº“
- [ ] æäº¤ä¿¡æ¯æ¸…æ™°æ˜ç¡®

## è„šæœ¬æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” | è¿è¡Œæ—¶é—´ |
|------|------|----------|
| `test-build-windows.bat` | å®Œæ•´æ„å»ºå’Œæ‰“åŒ… | 5-10åˆ†é’Ÿ |
| `dev-test.bat` | å¿«é€Ÿå¼€å‘æµ‹è¯• | 1-2åˆ†é’Ÿ |
| `check-dependencies.bat` | ä¾èµ–æ£€æŸ¥ | 10ç§’ |

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†çš„æ„å»ºæ—¥å¿—

åœ¨ `test-build-windows.bat` ä¸­æ·»åŠ ï¼š
```cmd
call pnpm run build:prod > build.log 2>&1
type build.log
```

### 2. æ£€æŸ¥ç‰¹å®šæ¨¡å—

```cmd
node -e "console.log(require.resolve('ms'))"
node -e "console.log(require('ms'))"
```

### 3. åˆ—å‡ºæ‰€æœ‰ä¾èµ–

```cmd
cd release\win-unpacked\resources\app
dir /s /b node_modules > dependencies.txt
notepad dependencies.txt
```

### 4. å¯¹æ¯”package.jsonå’Œå®é™…å®‰è£…çš„ä¾èµ–

```cmd
# åˆ—å‡ºpackage.jsonä¸­çš„ä¾èµ–
node -e "console.log(Object.keys(require('./package.json').dependencies).join('\n'))"

# åˆ—å‡ºå®é™…å®‰è£…çš„ä¾èµ–
dir /b node_modules
```

## ç›¸å…³èµ„æº

- [Electronæ–‡æ¡£](https://www.electronjs.org/docs/latest/)
- [electron-builderæ–‡æ¡£](https://www.electron.build/)
- [Node.jsæ–‡æ¡£](https://nodejs.org/docs/latest/api/)
- [pnpmæ–‡æ¡£](https://pnpm.io/)

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
2. æ£€æŸ¥GitHub Issues
3. æŸ¥çœ‹æ„å»ºæ—¥å¿—
4. åœ¨é¡¹ç›®ä¸­åˆ›å»ºæ–°çš„Issue

## æ€»ç»“

æœ¬åœ°æµ‹è¯•æµç¨‹ï¼š
1. ğŸ” **æ£€æŸ¥ä¾èµ–** â†’ `check-dependencies.bat`
2. âš¡ **å¿«é€Ÿæµ‹è¯•** â†’ `dev-test.bat`
3. ğŸ“¦ **å®Œæ•´æ„å»º** â†’ `test-build-windows.bat`
4. âœ… **éªŒè¯åŠŸèƒ½** â†’ æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
5. ğŸš€ **æ¨é€ä»£ç ** â†’ `git push`

è®°ä½ï¼š**æœ¬åœ°æµ‹è¯•é€šè¿‡åå†æ¨é€åˆ°GitHub**ï¼Œå¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ï¼
